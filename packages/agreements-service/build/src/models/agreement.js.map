{"version":3,"file":"agreement.js","sourceRoot":"","sources":["../../../src/models/agreement.ts"],"names":[],"mappings":";;AAAA,2CAAuC;AAEvC,mCAAmC;AAEnC,MAAa,SAAU,SAAQ,qBAAS;IACtC,MAAM,KAAK,SAAS;QAClB,OAAO,YAAY,CAAA;IACrB,CAAC;IAqBD,SAAS;QACP,OAAO,IAAI,CAAC,IAAI,KAAK,SAAS,CAAA;IAChC,CAAC;IAED,IAAI,UAAU;QACZ,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,UAAU,EAAE;YAClC,OAAO,mBAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAA;SAClF;QAED,OAAO,SAAS,CAAA;IAClB,CAAC;IAED,WAAW;QACT,OAAO;YACL,EAAE,EAAE,IAAI,CAAC,EAAE;YACX,KAAK,EAAE;gBACL,IAAI,EAAE,IAAI,CAAC,SAAS;gBACpB,KAAK,EAAE,IAAI,CAAC,UAAU;aACvB;YACD,WAAW,EAAE,IAAI,CAAC,WAAW,IAAI,SAAS;YAC1C,MAAM,EAAE,IAAI,CAAC,MAAM,IAAI,SAAS;YAChC,SAAS,EAAE,IAAI,CAAC,SAAS,IAAI,SAAS;YACtC,OAAO,EAAE,IAAI,CAAC,OAAO,IAAI,SAAS;YAClC,MAAM,EAAE,IAAI,CAAC,MAAM,IAAI,SAAS;YAChC,KAAK,EAAE,IAAI,CAAC,KAAK,IAAI,SAAS;YAC9B,MAAM,EAAE,IAAI,CAAC,MAAM,IAAI,SAAS;YAChC,QAAQ,EAAE,IAAI,CAAC,QAAQ,IAAI,SAAS;YACpC,MAAM,EAAE,IAAI,CAAC,MAAM,IAAI,SAAS;YAChC,GAAG,EAAE,IAAI,CAAC,GAAG,IAAI,SAAS;YAC1B,UAAU,EAAE,IAAI,CAAC,UAAU,IAAI,SAAS;YACxC,UAAU,EAAE,IAAI,CAAC,UAAU,IAAI,SAAS;YACxC,KAAK,EAAE,IAAI,CAAC,KAAK,IAAI,SAAS;YACjC,QAAQ,EAAE,IAAI,CAAC,QAAQ,IAAI,SAAS;YACpC,SAAS,EAAE,IAAI,CAAC,SAAS,IAAI,SAAS;SACpC,CAAA;IACH,CAAC;CACF;AA5DD,8BA4DC","sourcesContent":["import { BaseModel } from './baseModel'\nimport { Pojo } from 'objection'\nimport { createHmac } from 'crypto'\n\nexport class Agreement extends BaseModel {\n  static get tableName (): string {\n    return 'agreements'\n  }\n\n  assetCode!: string\n  assetScale!: number\n  amount!: string\n  description!: string\n  start!: number\n  expiry!: number\n  interval!: string\n  cycles!: number\n  cap!: boolean\n  userId!: number\n  accountId!: number\n  subject!: string\n  secret!: string\n  secretSalt!: string\n  scope!: string\n  callback!: string\n\ttype!: string\n\tcancelled!: number\n\n  isMandate (): boolean {\n    return this.type === 'mandate'\n  }\n\n  get secretHash (): string | undefined {\n    if (this.secret && this.secretSalt) {\n      return createHmac('SHA256', this.secretSalt).update(this.secret).digest('base64')\n    }\n\n    return undefined\n  }\n\n  $formatJson (): Pojo {\n    return {\n      id: this.id,\n      asset: {\n        code: this.assetCode,\n        scale: this.assetScale\n      },\n      description: this.description || undefined,\n      userId: this.userId || undefined,\n      accountId: this.accountId || undefined,\n      subject: this.subject || undefined,\n      amount: this.amount || undefined,\n      start: this.start || undefined,\n      expiry: this.expiry || undefined,\n      interval: this.interval || undefined,\n      cycles: this.cycles || undefined,\n      cap: this.cap || undefined,\n      secretSalt: this.secretSalt || undefined,\n      secretHash: this.secretHash || undefined,\n      scope: this.scope || undefined,\n\t\t\tcallback: this.callback || undefined,\n\t\t\tcancelled: this.cancelled || undefined\n    }\n  }\n}\n"]}